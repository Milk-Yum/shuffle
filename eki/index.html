<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eki Bottle Mail</title>
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; background: linear-gradient(180deg, #a1c4fd 0%, #c2e9fb 100%); min-height: 100vh; display: flex; flex-direction: column; align-items: center; color: #334d66; overflow-x: hidden; }
        .container { width: 90%; max-width: 400px; margin-top: 40px; text-align: center; }
        h1 { font-size: 1.5rem; color: #ffffff; text-shadow: 1px 1px 4px rgba(0,0,0,0.1); }
        .station-box { background: rgba(255, 255, 255, 0.6); padding: 15px; border-radius: 20px; margin-bottom: 20px; font-weight: bold; backdrop-filter: blur(5px); }
        .bottle-card { background: #ffffff; padding: 25px; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 15px; }
        textarea { width: 100%; height: 120px; border: 1px solid #e0e7ff; border-radius: 15px; padding: 12px; box-sizing: border-box; font-size: 16px; background: #f9fbff; -webkit-appearance: none; }
        .btn-send { background: #5dade2; color: white; border: none; padding: 15px; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; }
        .btn-pick-up { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: white; border: 2px solid #a1c4fd; border-radius: 50%; width: 70px; height: 70px; font-size: 40px; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        /* æ‹¾ã£ãŸæ™‚ã®è¡¨ç¤º */
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal { background: white; padding: 20px; border-radius: 20px; width: 80%; text-align: center; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Eki Bottle Mail</h1>
        <div id="station-display" class="station-box">æ½®ã®æµã‚Œã‚’ç¢ºèªä¸­...</div>
        <div class="bottle-card">
            <textarea id="message-input" placeholder="ä»Šã®æ°—æŒã¡ã‚’ãƒœãƒˆãƒ«ã«..."></textarea>
            <button class="btn-send" onclick="sendBottle()">æµ·ã¸æµã™</button>
        </div>
    </div>

    <button class="btn-pick-up" onclick="pickUpBottle()">ğŸ¾</button>

    <div id="overlay" onclick="this.style.display='none'">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>ãƒœãƒˆãƒ«ã®ä¸­èº«</h2>
            <p id="picked-text"></p>
            <button onclick="document.getElementById('overlay').style.display='none'">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç”¨
        window.onerror = function(m, u, l){ alert("Error: " + m + " (Line: " + l + ")"); };

        function getStation() {
            var display = document.getElementById('station-display');
            navigator.geolocation.getCurrentPosition(function(pos) {
                var url = "https://express.heartrails.com/api/json?method=getStations&x=" + pos.coords.longitude + "&y=" + pos.coords.latitude;
                fetch(url).then(function(res){ return res.json(); }).then(function(data){
                    if(data.response.station) {
                        var s = data.response.station[0];
                        display.innerText = s.line + " " + s.name + "é§… ä»˜è¿‘";
                    } else {
                        display.innerText = "é§…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
                    }
                }).catch(function(){ display.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼"; });
            }, function(){
                display.innerText = "ä½ç½®æƒ…å ±ã‚’ONã«ã—ã¦ãã ã•ã„";
            });
        }

        function sendBottle() {
            var msg = document.getElementById('message-input').value;
            if(!msg) return alert("ä¸­èº«ã‚’æ›¸ã„ã¦ã­");
            alert("æµã—ã¾ã—ãŸï¼\n" + msg);
            document.getElementById('message-input').value = "";
        }

        function pickUpBottle() {
            document.getElementById('picked-text').innerText = "èª°ã‹ã®ãƒœãƒˆãƒ«ã‚’æ‹¾ã„ã¾ã—ãŸï¼(ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)";
            document.getElementById('overlay').style.display = 'flex';
        }

        window.onload = getStation;
    </script>
</body>
</html>
